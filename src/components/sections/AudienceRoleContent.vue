<template>
  <div>
    <h3>è§‚ä¼—ï¼šæµé‡çš„æºå¤´ä¸æ¨æ‰‹</h3>
    <p class="intro-text">æ¯ä¸€ä¸ªç‚¹èµã€è¯„è®ºã€åˆ†äº«ï¼Œéƒ½åœ¨ä¸º"ç½‘çº¢å„¿ç«¥"äº§ä¸šæ·»ç –åŠ ç“¦ã€‚è§‚ä¼—çš„æ³¨æ„åŠ›å’Œäº’åŠ¨ï¼Œæ˜¯è¿™ä¸ªç”Ÿæ€ç³»ç»Ÿçš„åŸºçŸ³ã€‚</p>

    <div class="data-highlight">
      <p>å„¿ç«¥çŸ­è§†é¢‘çš„å¹³å‡æ’­æ”¾é‡æ¯”æˆäººå†…å®¹é«˜å‡º<span class="big">3-5å€</span></p>
      <p>å¸¦æœ‰"èŒå¨ƒ"æ ‡ç­¾çš„è§†é¢‘äº’åŠ¨ç‡æå‡<span class="big">40%</span></p>
    </div>

    <!-- è§‚ä¼—ç”»åƒåˆ†æ -->
    <h4 class="section-subtitle">è°åœ¨è§‚çœ‹èŒå¨ƒè§†é¢‘ï¼Ÿ</h4>

    <div class="audience-summary">
      <p>è§‚çœ‹èŒå¨ƒç±»çŸ­è§†é¢‘çš„è§‚ä¼—ç”»åƒç‰¹å¾ï¼š</p>
      <ul>
        <li><strong>å¹´é¾„ï¼š</strong>31-40å²å æ¯”æœ€é«˜ï¼Œ18-23å²åå¥½åº¦æœ€é«˜</li>
        <li><strong>æ€§åˆ«ï¼š</strong>å¥³æ€§å æ¯”68%ï¼Œåå¥½åº¦ï¼ˆTGIï¼‰è¾¾128</li>
        <li><strong>åœ°åŸŸï¼š</strong>å¹¿ä¸œå æ¯”æœ€é«˜ï¼Œè¾½å®åå¥½åº¦ï¼ˆTGIæŒ‡æ•°ï¼‰æœ€é«˜</li>
      </ul>
    </div>

    <div class="audience-charts">
      <!-- å¹´é¾„åˆ†å¸ƒå›¾ -->
      <div class="chart-card">
        <div class="chart-header">
          <h5>å¹´é¾„åˆ†å¸ƒ</h5>
        </div>
        <div class="chart-summary">
          <span class="highlight-text">31-40å²</span>å¹´é¾„æ®µå æ¯”æœ€é«˜ï¼Œ
          <span class="highlight-text">18-23å²</span>å¹´é¾„æ®µåå¥½åº¦ï¼ˆTGIæŒ‡æ•°ï¼‰æœ€é«˜
        </div>
        <div class="chart-legend">
          <span class="legend-item">
            <span class="legend-color" style="background: #5B8FF9"></span>
            å æ¯”
          </span>
          <span class="legend-item">
            <span class="legend-color" style="background: #5AD8A6"></span>
            TGI
          </span>
        </div>
        <div class="chart-container" ref="chartAudienceAge"></div>
      </div>

      <!-- æ€§åˆ«åˆ†å¸ƒå›¾ -->
      <div class="chart-card">
        <div class="chart-header">
          <h5>æ€§åˆ«åˆ†å¸ƒ</h5>
        </div>
        <div class="chart-summary">
          <span class="highlight-text">å¥³æ€§</span>å æ¯”æœ€é«˜ï¼Œ
          <span class="highlight-text">å¥³æ€§</span>åå¥½åº¦ï¼ˆTGIæŒ‡æ•°ï¼‰æœ€é«˜
        </div>
        <div class="chart-container gender-chart" ref="chartAudienceGender"></div>
      </div>
    </div>

    <!-- åœ°åŸŸåˆ†å¸ƒ -->
    <h4 class="section-subtitle">åœ°åŸŸåˆ†å¸ƒç‰¹å¾</h4>
    <p class="data-note">
      è§‚çœ‹èŒå¨ƒç±»çŸ­è§†é¢‘çš„è§‚ä¼—ä¸­ï¼Œå¹¿ä¸œå æ¯”æœ€é«˜ï¼Œè¾½å®åå¥½åº¦ï¼ˆTGIæŒ‡æ•°ï¼‰æœ€é«˜
    </p>
    <div class="chart-container map-chart" ref="chartAudienceRegion"></div>

    <!-- è¯„è®ºè¯äº‘ -->
    <h4 class="section-subtitle">è¯„è®ºåŒºçš„å£°éŸ³</h4>

    <!-- è§‚ä¼—å¿ƒç†åˆ†æ -->
    <div class="audience-psychology">
      <div class="psychology-positive">
        <p>è§‚çœ‹è€…ä¸­ä¸ä¹çœŸæ­£å–œçˆ±å­©å­ã€é€šè¿‡è§†é¢‘è·å¾—æƒ…æ„Ÿæ…°è—‰çš„ç”¨æˆ·ã€‚ä¸€ä¸ªæœ‰è¶£çš„ç°è±¡æ˜¯ï¼Œä¸å°‘å¤´éƒ¨èŒå¨ƒè´¦å·çš„ç²‰ä¸ä¸­ï¼Œ<strong>18-23å²çš„å¹´è½»äººå¯¹èŒå¨ƒè§†é¢‘çš„åå¥½åº¦æœ€é«˜</strong>ã€‚</p>
        <p>
          ä»è¿›åŒ–å¿ƒç†å­¦è§’åº¦è§£é‡Šï¼Œè¿™ç§ç°è±¡æ˜¯å› ä¸ºäººç±»å¤©ç”Ÿä¼šå¯¹å…·æœ‰"å©´å„¿å›¾å¼"ï¼ˆå¦‚åœ†è„¸ã€å¤§çœ¼ç­‰ç‰¹å¾ï¼‰çš„å¹¼å´½äº§ç”Ÿä¿æŠ¤æ¬²å’Œäº²å¯†æ„Ÿï¼Œè¿™æ˜¯ä¸€ç§æœ¬èƒ½ååº”ï¼Œè€Œå¥³æ€§é€šå¸¸å¯¹æ­¤æ›´ä¸ºæ•æ„Ÿã€‚èŒå¨ƒä»¬å¤©çœŸæ— é‚ªçš„è¨€è¡Œå’Œæ¸©é¦¨çš„å®¶åº­äº’åŠ¨åœºæ™¯ï¼Œä¸ºå¹´è½»è§‚ä¼—æä¾›äº†ä¸€ä¸ªé€ƒç¦»ç°å®å‹åŠ›ã€è·å¾—æƒ…ç»ªç–—æ„ˆçš„çª—å£ã€‚è§‚çœ‹è¿™äº›å†…å®¹èƒ½æœ‰æ•ˆç¼“è§£ç„¦è™‘ï¼Œå¸¦æ¥è½»æ¾å’Œå¿«ä¹ã€‚
        </p>
      </div>

      <div class="psychology-negative">
        <p>
          <strong>"å•ƒå¨ƒé€»è¾‘"</strong>æ­£åœ¨é€æ¸è¢«æ›´å¤šäººæ¥å—ã€‚ç”šè‡³å‡ºç°äº†ä¸€æ‰¹"æ¯å©´åšä¸»é™ªè·‘""å®å¦ˆä¸“ä¸šè¿è¥"ç­‰ä¸“é—¨æ•™å¯¼å®¶é•¿å¦‚ä½•æ‰“é€ "å°ç½‘çº¢"çš„è´¦å·ã€‚ç›¸å…³è§†é¢‘è¯„è®ºåŒºé‡Œï¼Œå¯¹å¹¼ç«¥æ“¦è¾¹å†…å®¹çš„è¿½æ§ã€å¯¹å„¿ç«¥"å°å°å¹´çºªæŒ£å¤§é’±"çš„ç¾¡æ…•ã€‚
        </p>
      </div>
    </div>

    <div class="chart-container wordcloud-chart" ref="chartWordCloud"></div>

    <!-- æµé‡ç‹‚æ½®æ¡ˆä¾‹ -->
    <div class="traffic-craze">
      <p class="craze-intro">
        èŒå¨ƒçš„å¤©ç„¶æµé‡ä¼˜åŠ¿å†åŠ ä¹‹ç²‰ä¸è¿½æ§ï¼Œ"æ™’å¨ƒ"è¡Œä¸ºåœ¨ç›¸å…³å¹³å°è¶Šçƒ§è¶Šæ—ºã€‚
      </p>
      <div class="craze-case">
        <div class="case-image-wrapper">
          <img :src="trafficCaseImg" alt="æ–°ç”Ÿå„¿ç½‘çº¢æ¡ˆä¾‹" class="case-image" />
        </div>
        <p class="case-caption">
          æŸåƒä¸‡çº§ç½‘çº¢çˆ¶æ¯ä¸ºå…¶æ–°ç”Ÿå„¿"å…‰é€Ÿ"æ³¨å†Œè´¦å·ã€‚ä»…1æ¡è§†é¢‘ï¼ŒæŠ–éŸ³å¸ç²‰åå‡ ä¸‡ï¼Œç‚¹èµè¶…30ä¸‡ã€‚
        </p>
      </div>
    </div>

    <!-- è§‚ä¼—è´£ä»»æç¤º -->
    <div class="responsibility-box">
      <p>è§‚ä¼—çš„æ¯ä¸€æ¬¡ç‚¹å‡»ã€æ¯ä¸€ä¸ªèµï¼Œéƒ½åœ¨æ— å½¢ä¸­é¼“åŠ±ç€æ›´å¤šçˆ¶æ¯å°†å­©å­æ¨å‘é•œå¤´ã€‚è€Œå¹³å°çš„ç®—æ³•ä¼šè¿›ä¸€æ­¥æ”¾å¤§è¿™ç§æ•ˆåº”ï¼Œè®©"èŒå¨ƒ"å†…å®¹è·å¾—æ›´å¤šæ›å…‰ï¼Œå½¢æˆæ­£åé¦ˆå¾ªç¯ã€‚</p>
      <p><strong>ä½œä¸ºè§‚ä¼—ï¼Œæˆ‘ä»¬éœ€è¦æ„è¯†åˆ°ï¼š</strong>æˆ‘ä»¬çš„å…³æ³¨å’Œäº’åŠ¨ï¼Œå¯èƒ½åœ¨æ— æ„ä¸­æˆä¸ºäº†å„¿ç«¥è¢«è¿‡åº¦æ›å…‰çš„æ¨æ‰‹ã€‚ç†æ€§æ¶ˆè´¹å†…å®¹ï¼Œæ‹’ç»çŒå¥‡å’Œæ¶ˆè´¹å„¿ç«¥éšç§çš„è§†é¢‘ï¼Œæ˜¯æ¯ä¸ªè§‚ä¼—åº”æœ‰çš„è´£ä»»ã€‚</p>
    </div>

    <p class="data-source">
      æ•°æ®æ¥æºï¼šQuestMobileã€Š2024çŸ­è§†é¢‘ç”¨æˆ·ç ”ç©¶æŠ¥å‘Šã€‹ã€å·¨é‡ç®—æ•°ã€ŠèŒå¨ƒå†…å®¹è§‚ä¼—æ´å¯ŸæŠ¥å‘Šã€‹
    </p>
  </div>
</template>

<script setup>
import { ref, onMounted, onUnmounted } from 'vue'
import * as echarts from 'echarts'

const chartAudienceAge = ref(null)
const chartAudienceGender = ref(null)
const chartAudienceRegion = ref(null)
const chartWordCloud = ref(null)

// æµé‡æ¡ˆä¾‹å›¾ç‰‡
const trafficCaseImg = new URL('@/assets/images/10.png', import.meta.url).href

let cloudObserver = null

onMounted(() => {
  // å¹´é¾„åˆ†å¸ƒï¼ˆåŒè½´æŸ±çŠ¶å›¾ï¼‰
  if (chartAudienceAge.value) {
    const myChartAge = echarts.init(chartAudienceAge.value)
    myChartAge.setOption({
      grid: { left: '12%', right: '12%', top: '15%', bottom: '15%' },
      tooltip: {
        trigger: 'axis',
        axisPointer: { type: 'shadow' }
      },
      xAxis: {
        type: 'category',
        data: ['18-23å²', '24-30å²', '31-40å²', '41-50å²', '51å²+'],
        axisLine: { lineStyle: { color: '#E5E5E5' } },
        axisTick: { show: false },
        axisLabel: { color: '#666' }
      },
      yAxis: [
        {
          type: 'value',
          name: 'å æ¯”',
          position: 'left',
          axisLabel: { formatter: '{value}%', color: '#666' },
          axisLine: { show: false },
          splitLine: { lineStyle: { color: '#F0F0F0', type: 'dashed' } },
          max: 32
        },
        {
          type: 'value',
          name: 'TGI',
          position: 'right',
          axisLabel: { color: '#666' },
          axisLine: { show: false },
          splitLine: { show: false },
          max: 280
        }
      ],
      series: [
        {
          name: 'å æ¯”',
          type: 'bar',
          data: [24, 24, 30, 12, 10],
          barWidth: '35%',
          itemStyle: {
            color: '#5B8FF9',
            borderRadius: [4, 4, 0, 0]
          }
        },
        {
          name: 'TGI',
          type: 'line',
          yAxisIndex: 1,
          data: [250, 180, 95, 60, 100],
          smooth: true,
          symbol: 'circle',
          symbolSize: 8,
          itemStyle: {
            color: '#5AD8A6',
            borderWidth: 2,
            borderColor: '#fff'
          },
          lineStyle: {
            color: '#5AD8A6',
            width: 3
          },
          markLine: {
            silent: true,
            symbol: 'none',
            lineStyle: {
              color: '#FFBB00',
              type: 'dashed',
              width: 2
            },
            data: [{ yAxis: 100 }],
            label: { show: false }
          }
        }
      ]
    })
  }

  // æ€§åˆ«åˆ†å¸ƒï¼ˆäººå½¢å›¾æ ‡å±•ç¤ºï¼‰
  if (chartAudienceGender.value) {
    const container = chartAudienceGender.value
    container.innerHTML = `
      <div style="display: flex; justify-content: space-around; align-items: flex-end; height: 320px; padding: 30px 20px;">
        <div style="text-align: center; display: flex; flex-direction: column; align-items: center;">
          <div style="position: relative; margin-bottom: 20px;">
            <svg width="110" height="170" viewBox="0 0 120 180">
              <circle cx="60" cy="30" r="25" fill="#B0B0B0"/>
              <rect x="35" y="55" width="50" height="60" rx="8" fill="#B0B0B0"/>
              <rect x="42" y="115" width="15" height="60" rx="8" fill="#5B8FF9"/>
              <rect x="63" y="115" width="15" height="60" rx="8" fill="#5B8FF9"/>
            </svg>
          </div>
          <div style="font-size: 18px; color: #5B8FF9; font-weight: bold; margin-bottom: 8px;">ç”·æ€§</div>
          <div style="font-size: 15px; color: #666; margin-bottom: 4px;">
            å æ¯”: <span style="font-weight: bold; color: #333;">32%</span>
          </div>
          <div style="font-size: 15px; color: #666;">
            TGI: <span style="font-weight: bold; color: #333;">68</span>
          </div>
        </div>

        <div style="text-align: center; display: flex; flex-direction: column; align-items: center;">
          <div style="position: relative; margin-bottom: 20px;">
            <svg width="110" height="170" viewBox="0 0 120 180">
              <circle cx="60" cy="30" r="25" fill="#B0B0B0"/>
              <path d="M 40 55 L 35 115 L 85 115 L 80 55 Z" fill="#FF6B9D" rx="5"/>
              <rect x="37" y="55" width="46" height="25" rx="8" fill="#B0B0B0"/>
              <rect x="42" y="115" width="15" height="60" rx="8" fill="#FF6B9D"/>
              <rect x="63" y="115" width="15" height="60" rx="8" fill="#FF6B9D"/>
            </svg>
          </div>
          <div style="font-size: 18px; color: #FF6B9D; font-weight: bold; margin-bottom: 8px;">å¥³æ€§</div>
          <div style="font-size: 15px; color: #666; margin-bottom: 4px;">
            å æ¯”: <span style="font-weight: bold; color: #333;">68%</span>
          </div>
          <div style="font-size: 15px; color: #666;">
            TGI: <span style="font-weight: bold; color: #333;">128</span>
          </div>
        </div>
      </div>
    `
  }

  // åœ°åŸŸåˆ†å¸ƒï¼ˆäº¤äº’åœ°å›¾ï¼‰
  if (chartAudienceRegion.value) {
    const el = chartAudienceRegion.value
    const myChartRegion = echarts.init(el)
    const regionData = [
      { name: 'å¹¿ä¸œ', value: 15.2 },
      { name: 'è¾½å®', value: 12.8 },
      { name: 'æ±Ÿè‹', value: 10.5 },
      { name: 'æµ™æ±Ÿ', value: 9.8 },
      { name: 'å±±ä¸œ', value: 8.6 },
      { name: 'æ²³å—', value: 7.3 },
      { name: 'å››å·', value: 6.9 },
      { name: 'æ¹–åŒ—', value: 6.2 },
      { name: 'åŒ—äº¬', value: 5.8 },
      { name: 'ä¸Šæµ·', value: 5.1 }
    ]
      ; (async () => {
        try {
          const mapUrl = `${import.meta.env.BASE_URL}china.json`
          const res = await fetch(mapUrl)
          if (!res.ok) throw new Error('map not found')
          const mapJson = await res.json()
          echarts.registerMap('china', mapJson)

          const values = regionData.map(d => d.value)
          const minVal = Math.min(...values)
          const maxVal = Math.max(...values)

          myChartRegion.setOption({
            tooltip: {
              trigger: 'item',
              formatter: (p) => (p?.value
                ? `<strong>${p.name}</strong><br/>å æ¯”ï¼š<span style="color:#667eea;font-weight:bold;">${p.value}%</span>`
                : `${p.name}<br/>æš‚æ— æ•°æ®`),
              backgroundColor: 'rgba(255,255,255,0.95)',
              borderColor: '#ddd',
              borderWidth: 1,
              textStyle: { color: '#333' }
            },
            visualMap: {
              min: Math.floor(minVal),
              max: Math.ceil(maxVal),
              left: 30,
              bottom: 40,
              text: ['é«˜', 'ä½'],
              inRange: { color: ['#fee5d9', '#fcae91', '#fb6a4a', '#de2d26', '#a50f15'] },
              textStyle: { color: '#666' },
              calculable: true
            },
            series: [{
              type: 'map',
              map: 'china',
              roam: true,
              scaleLimit: { min: 1, max: 3 },
              emphasis: {
                label: { show: true, color: '#fff' },
                itemStyle: { areaColor: '#667eea', shadowBlur: 10, shadowColor: 'rgba(0,0,0,0.3)' }
              },
              select: { label: { show: true }, itemStyle: { areaColor: '#764ba2' } },
              itemStyle: { borderColor: '#fff', borderWidth: 1, shadowBlur: 5, shadowColor: 'rgba(0,0,0,0.1)' },
              data: regionData
            }]
          })
        } catch (e) {
          console.warn('China map load failed:', e)
        }
      })()
  }

  // è¯„è®ºè¯äº‘ï¼ˆæ‡’åŠ è½½ï¼‰
  if (chartWordCloud.value) {
    const el = chartWordCloud.value
    let inited = false
    const words = [
      { name: 'å¯çˆ±', value: 1000 }, { name: 'å®å®', value: 950 }, { name: 'æ¼‚äº®', value: 900 },
      { name: 'å¤©ä½¿', value: 850 }, { name: 'èŒ', value: 800 }, { name: 'å–œæ¬¢', value: 750 },
      { name: 'å¦¹å¦¹', value: 700 }, { name: 'å¥³å„¿', value: 680 }, { name: 'å°å­©', value: 650 },
      { name: 'æ²»æ„ˆ', value: 620 }, { name: 'ç«¥å¹´', value: 600 }, { name: 'å¹¸ç¦', value: 580 },
      { name: 'æ¸©æŸ”', value: 560 }, { name: 'å¤©çœŸ', value: 540 }, { name: 'å¿«ä¹', value: 520 },
      { name: 'å¦ˆå¦ˆ', value: 500 }, { name: 'ç²¾è‡´', value: 480 }, { name: 'å°è£™å­', value: 460 },
      { name: 'å¥½çœ‹', value: 440 }, { name: 'æŠ±æŠ±', value: 420 }, { name: 'æ‰“æ‰®', value: 400 },
      { name: 'èˆè¹ˆ', value: 380 }, { name: 'å®¶é•¿', value: 360 }, { name: 'æ‘†æ‹', value: 340 },
      { name: 'ç‚«å¨ƒ', value: 320 }, { name: 'æ¼”æˆ', value: 300 }, { name: 'è™šä¼ª', value: 280 },
      { name: 'åˆ©ç”¨å­©å­', value: 260 }, { name: 'åˆ»æ„', value: 240 }, { name: 'ç¦»è°±', value: 220 },
      { name: 'åƒµç¡¬', value: 200 }
    ]

    // åˆ›å»ºæ‰‹æœºå½¢çŠ¶çš„é®ç½©å›¾ç‰‡
    const createPhoneMask = () => {
      const canvas = document.createElement('canvas')
      const size = 600
      canvas.width = size
      canvas.height = size
      const ctx = canvas.getContext('2d')

      // ç»˜åˆ¶æ‰‹æœºå¤–å½¢
      ctx.fillStyle = '#000'
      ctx.beginPath()

      // æ‰‹æœºä¸»ä½“ - åœ†è§’çŸ©å½¢
      const phoneWidth = 300
      const phoneHeight = 520
      const offsetX = (size - phoneWidth) / 2
      const offsetY = (size - phoneHeight) / 2
      const radius = 40

      ctx.moveTo(offsetX + radius, offsetY)
      ctx.lineTo(offsetX + phoneWidth - radius, offsetY)
      ctx.arcTo(offsetX + phoneWidth, offsetY, offsetX + phoneWidth, offsetY + radius, radius)
      ctx.lineTo(offsetX + phoneWidth, offsetY + phoneHeight - radius)
      ctx.arcTo(offsetX + phoneWidth, offsetY + phoneHeight, offsetX + phoneWidth - radius, offsetY + phoneHeight, radius)
      ctx.lineTo(offsetX + radius, offsetY + phoneHeight)
      ctx.arcTo(offsetX, offsetY + phoneHeight, offsetX, offsetY + phoneHeight - radius, radius)
      ctx.lineTo(offsetX, offsetY + radius)
      ctx.arcTo(offsetX, offsetY, offsetX + radius, offsetY, radius)
      ctx.closePath()
      ctx.fill()

      // ç»˜åˆ¶é¡¶éƒ¨åˆ˜æµ·ï¼ˆå¯é€‰ï¼‰
      ctx.fillRect(offsetX + phoneWidth / 2 - 60, offsetY + 10, 120, 25)

      return canvas
    }

    cloudObserver = new IntersectionObserver((entries) => {
      entries.forEach(async (entry) => {
        if (entry.isIntersecting && !inited) {
          inited = true
          let loaded = true
          try { await import('echarts-wordcloud') } catch (_) { loaded = false }
          if (!loaded) { cloudObserver?.unobserve(el); return }

          const maskImage = createPhoneMask()
          const inst = echarts.init(el)

          inst.setOption({
            tooltip: { show: true, formatter: (p) => `${p.name}<br/>çƒ­åº¦: ${p.value}` },
            series: [{
              type: 'wordCloud',
              gridSize: 8,
              sizeRange: [14, 55],
              rotationRange: [-20, 20],
              maskImage: maskImage,
              width: '100%',
              height: '100%',
              drawOutOfBound: false,
              layoutAnimation: true,
              textStyle: {
                fontFamily: 'sans-serif',
                fontWeight: 'bold',
                color: (params) => {
                  const negative = ['æ‘†æ‹', 'ç‚«å¨ƒ', 'æ¼”æˆ', 'è™šä¼ª', 'åˆ©ç”¨å­©å­', 'åˆ»æ„', 'ç¦»è°±', 'åƒµç¡¬', 'å®¶é•¿']
                  if (negative.includes(params.name)) {
                    const dark = ['#e74c3c', '#c0392b', '#d35400', '#e67e22']
                    return dark[Math.floor(Math.random() * dark.length)]
                  }
                  const colors = ['#5470c6', '#91cc75', '#fac858', '#73c0de', '#3ba272', '#fc8452', '#9a60b4', '#ea7ccc']
                  return colors[Math.floor(Math.random() * colors.length)]
                }
              },
              emphasis: {
                focus: 'self',
                textStyle: {
                  shadowBlur: 15,
                  shadowColor: 'rgba(0,0,0,0.4)',
                  fontSize: 18
                }
              },
              data: words
            }]
          })
          cloudObserver?.unobserve(el)
        }
      })
    }, { threshold: 0.25 })
    cloudObserver.observe(el)
  }
})

onUnmounted(() => {
  cloudObserver?.disconnect?.()
    ;[chartAudienceAge, chartAudienceGender, chartAudienceRegion, chartWordCloud].forEach(r => {
      if (r?.value) {
        const inst = echarts.getInstanceByDom(r.value)
        inst && inst.dispose()
      }
    })
})
</script>

<style scoped>
/* ==================== æ–‡æœ¬æ ·å¼ ==================== */
.intro-text {
  font-size: 1.05rem;
  line-height: 1.8;
  color: #555;
  margin-bottom: 25px;
  text-align: justify;
  text-justify: inter-ideograph;
  word-break: keep-all;
  overflow-wrap: break-word;
}

/* ==================== æ•°æ®é«˜äº®æ ·å¼ ==================== */
.data-highlight {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  padding: 30px 35px;
  border-radius: 18px;
  color: white;
  margin: 25px 0 40px;
  box-shadow: 0 10px 30px rgba(102, 126, 234, 0.35);
}

.data-highlight p {
  margin: 12px 0;
  font-size: 1.1rem;
  line-height: 1.9;
  word-break: keep-all;
  overflow-wrap: break-word;
}

.data-highlight .big {
  font-size: 1.9rem;
  font-weight: 800;
  color: #ffd700;
  text-shadow: 2px 2px 6px rgba(0, 0, 0, 0.4);
  padding: 0 5px;
}

/* ==================== å°æ ‡é¢˜æ ·å¼ ==================== */
.section-subtitle {
  font-size: 1.5rem;
  font-weight: 700;
  color: #2c3e50;
  margin: 40px 0 25px;
  padding-bottom: 12px;
  border-bottom: 3px solid transparent;
  border-image: linear-gradient(90deg, #667eea, #764ba2) 1;
  position: relative;
}

/* ==================== è§‚ä¼—æ€»ç»“æ¡† ==================== */
.audience-summary {
  background: linear-gradient(135deg, rgba(102, 126, 234, 0.08), rgba(118, 75, 162, 0.08));
  padding: 20px 25px;
  border-radius: 14px;
  margin: 20px 0 30px;
  border-left: 4px solid #667eea;
  box-shadow: 0 3px 15px rgba(102, 126, 234, 0.1);
}

.audience-summary p {
  font-size: 1.05rem;
  font-weight: 600;
  color: #2c3e50;
  margin: 0 0 12px 0;
}

.audience-summary ul {
  list-style: none;
  padding: 0;
  margin: 0;
}

.audience-summary li {
  font-size: 1rem;
  color: #555;
  line-height: 2;
  padding-left: 25px;
  position: relative;
}

.audience-summary li::before {
  content: 'â–¸';
  position: absolute;
  left: 0;
  color: #667eea;
  font-size: 1.2rem;
  font-weight: bold;
}

.audience-summary li strong {
  color: #667eea;
  font-weight: 700;
}

/* ==================== å›¾è¡¨å®¹å™¨æ ·å¼ ==================== */
.audience-charts {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
  gap: 25px;
  margin: 25px 0 40px;
}

.chart-card {
  background: white;
  border-radius: 16px;
  padding: 25px;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
  transition: all 0.3s;
}

.chart-card:hover {
  transform: translateY(-5px);
  box-shadow: 0 8px 30px rgba(102, 126, 234, 0.15);
}

.chart-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 15px;
}

.chart-header h5 {
  font-size: 1.2rem;
  font-weight: 700;
  color: #333;
  margin: 0;
}

.chart-summary {
  background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
  padding: 14px 18px;
  border-radius: 12px;
  font-size: 0.95rem;
  color: #666;
  margin-bottom: 15px;
  line-height: 1.7;
  border-left: 4px solid #667eea;
}

.highlight-text {
  color: #667eea;
  font-weight: 700;
  font-size: 1.05rem;
}

.chart-legend {
  display: flex;
  gap: 20px;
  margin-bottom: 15px;
  padding-left: 8px;
}

.legend-item {
  display: flex;
  align-items: center;
  gap: 8px;
  font-size: 0.9rem;
  color: #666;
  font-weight: 500;
}

.legend-color {
  width: 14px;
  height: 14px;
  border-radius: 3px;
}

.chart-container {
  width: 100%;
  height: 340px;
}

.gender-chart {
  height: 320px;
}

.map-chart {
  height: 450px;
  background: white;
  border-radius: 16px;
  padding: 20px;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
  margin: 20px 0 40px;
}

.wordcloud-chart {
  height: 550px;
  background: white;
  border-radius: 16px;
  padding: 20px;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
  margin: 20px 0 30px;
  position: relative;
}

.data-note {
  text-align: justify;
  text-justify: inter-ideograph;
  color: #666;
  font-size: 1rem;
  line-height: 1.6;
  margin: 20px auto;
  padding: 15px 20px;
  background: linear-gradient(135deg, rgba(102, 126, 234, 0.05), rgba(118, 75, 162, 0.05));
  border-radius: 12px;
  border-left: 4px solid #667eea;
}

/* ==================== è§‚ä¼—å¿ƒç†åˆ†æ ==================== */
.audience-psychology {
  margin: 25px 0 30px;
  display: flex;
  flex-direction: column;
  gap: 20px;
}

.psychology-positive {
  background: linear-gradient(135deg, rgba(91, 143, 249, 0.08), rgba(90, 216, 166, 0.08));
  padding: 25px 30px;
  border-radius: 16px;
  border-left: 5px solid #5B8FF9;
  box-shadow: 0 4px 15px rgba(91, 143, 249, 0.1);
  position: relative;
}

.psychology-positive::before {
  content: 'ğŸ’™';
  position: absolute;
  top: 20px;
  right: 25px;
  font-size: 2rem;
  opacity: 0.3;
}

.psychology-positive p {
  color: #555;
  font-size: 1.05rem;
  line-height: 1.9;
  margin: 12px 0;
  word-break: keep-all;
  overflow-wrap: break-word;
}

.psychology-positive strong {
  color: #5B8FF9;
  font-weight: 700;
}

.psychology-negative {
  background: linear-gradient(135deg, rgba(255, 107, 107, 0.08), rgba(255, 152, 0, 0.08));
  padding: 25px 30px;
  border-radius: 16px;
  border-left: 5px solid #ff6b6b;
  box-shadow: 0 4px 15px rgba(255, 107, 107, 0.1);
  position: relative;
}

.psychology-negative::before {
  content: 'âš ï¸';
  position: absolute;
  top: 20px;
  right: 25px;
  font-size: 2rem;
  opacity: 0.4;
}

.psychology-negative p {
  color: #555;
  font-size: 1.05rem;
  line-height: 1.9;
  margin: 0;
  word-break: keep-all;
  overflow-wrap: break-word;
}

.psychology-negative strong {
  color: #ff6b6b;
  font-weight: 700;
}

/* ==================== æµé‡ç‹‚æ½®æ¡ˆä¾‹ ==================== */
.traffic-craze {
  margin: 40px 0;
  padding: 30px;
  background: linear-gradient(135deg, rgba(102, 126, 234, 0.05), rgba(118, 75, 162, 0.05));
  border-radius: 18px;
  border: 2px dashed rgba(102, 126, 234, 0.3);
}

.craze-intro {
  font-size: 1.1rem;
  line-height: 1.8;
  color: #555;
  text-align: center;
  margin: 0 0 30px 0;
  font-weight: 500;
}

.craze-case {
  max-width: 550px;
  margin: 0 auto;
  background: white;
  border-radius: 16px;
  overflow: hidden;
  box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12);
  transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
}

.craze-case:hover {
  transform: translateY(-8px);
  box-shadow: 0 15px 45px rgba(102, 126, 234, 0.25);
}

.case-image-wrapper {
  width: 100%;
  overflow: hidden;
  background: #f8f9fa;
  position: relative;
}

.case-image {
  width: 100%;
  height: auto;
  display: block;
  transition: transform 0.5s ease;
}

.craze-case:hover .case-image {
  transform: scale(1.08);
}

.case-caption {
  padding: 25px 30px;
  font-size: 1.1rem;
  line-height: 1.9;
  color: #2c3e50;
  font-weight: 600;
  text-align: center;
  margin: 0;
  background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
  border-top: 3px solid #667eea;
}

/* ==================== è´£ä»»æç¤ºæ¡† ==================== */
.responsibility-box {
  background: linear-gradient(135deg, rgba(255, 193, 7, 0.1), rgba(255, 152, 0, 0.1));
  padding: 25px 30px;
  border-radius: 16px;
  margin: 40px 0 20px;
  border-left: 5px solid #ff9800;
  box-shadow: 0 4px 15px rgba(255, 152, 0, 0.1);
}

.responsibility-box p {
  color: #555;
  font-size: 1.05rem;
  line-height: 1.8;
  margin: 12px 0;
  word-break: keep-all;
  overflow-wrap: break-word;
}

.responsibility-box strong {
  color: #ff9800;
  font-weight: 700;
}

.data-source {
  text-align: center;
  color: #666;
  font-size: 0.85rem;
  margin: 30px auto 20px;
  max-width: 900px;
  padding: 0 20px;
}

/* ==================== å“åº”å¼è®¾è®¡ ==================== */
@media (max-width: 1024px) {
  .audience-charts {
    grid-template-columns: 1fr;
  }
}

@media (max-width: 768px) {
  .data-highlight {
    padding: 20px 25px;
  }

  .data-highlight .big {
    font-size: 1.5rem;
  }

  .section-subtitle {
    font-size: 1.3rem;
  }

  .audience-summary {
    padding: 18px 20px;
  }

  .audience-summary p {
    font-size: 1rem;
  }

  .audience-summary li {
    font-size: 0.95rem;
    line-height: 1.8;
  }

  .chart-card {
    padding: 20px;
  }

  .chart-container {
    height: 300px;
  }

  .map-chart {
    height: 350px;
  }

  .wordcloud-chart {
    height: 450px;
  }

  .psychology-positive,
  .psychology-negative {
    padding: 20px 25px;
  }

  .psychology-positive::before,
  .psychology-negative::before {
    font-size: 1.5rem;
    top: 15px;
    right: 20px;
  }

  .psychology-positive p,
  .psychology-negative p {
    font-size: 1rem;
    line-height: 1.8;
  }

  .traffic-craze {
    padding: 25px 20px;
    margin: 30px 0;
  }

  .craze-intro {
    font-size: 1rem;
    margin-bottom: 20px;
  }

  .case-caption {
    padding: 20px 25px;
    font-size: 1rem;
  }

  .responsibility-box {
    padding: 20px 20px;
  }

  .responsibility-box p {
    font-size: 1rem;
  }
}
</style>